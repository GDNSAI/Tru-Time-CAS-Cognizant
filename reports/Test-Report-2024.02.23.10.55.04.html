function validateForm() {
    let isValid = true;
    const status = document.getElementById('status').value;
    
    // Correct variable name to lowercase 'fields'
    const alwaysRequired = [ /*... your field names ...*/ ];
    const currentOnlyFields = [ /*... your field names ...*/ ];
    
    const requiredFields = status === 'Current' 
        ? [...alwaysRequired, ...currentOnlyFields] 
        : alwaysRequired;

    requiredFields.forEach(field => {
        const input = document.getElementById(field);
        const errorElement = document.getElementById(`${field}Error`); // Get error element

        // 1. Check if element exists before using it
        if (!input) {
            console.error(`Missing input field: ${field}`);
            isValid = false;
            return;
        }

        // 2. Check for empty values
        if (!input.value.trim()) {
            input.classList.add("invalid");
            if (errorElement) {
                errorElement.textContent = `${field} is required.`; // Fixed message
            }
            isValid = false;
        } else {
            input.classList.remove("invalid");
            if (errorElement) {
                errorElement.textContent = '';
            }
        }

        // 3. Add field-specific validations
        if (field === 'associateId' && status === 'Current') {
            if (!/^\d{7}$/.test(input.value)) {
                input.classList.add("invalid");
                if (errorElement) {
                    errorElement.textContent = "Must be 7 digits";
                }
                isValid = false;
            }
        }
    });

    return isValid;
}
