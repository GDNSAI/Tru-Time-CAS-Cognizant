<script>
    // Add status change handler
    document.getElementById('status').addEventListener('change', function() {
        if (this.value === 'Historic') {
            clearHistoricFields();
        }
    });

    function clearHistoricFields() {
        const fieldsToClear = [
            'billingRate', 'homeManagerId', 'homeManagerName', 'projectPoc', 'zId',
            'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject', 'onsiteOffshoreProject'
        ];
        
        fieldsToClear.forEach(field => {
            document.getElementById(field).value = '';
            document.getElementById(field).disabled = true;
        });
    }

    function validateForm() {
        let isValid = true;
        const status = document.getElementById('status').value;
        const alwaysRequired = [
            'esaProjectId', 'esaProjectName', 'associateId', 'name', 'designation', 'location',
            'onOff', 'billable', 'allocationStartDate', 'billingStartDate', 'allocationEndDate',
            'billingEndDate', 'status', 'requisitionSowContractNumber', 'allyTrack', 'subTrack',
            'engagementManager', 'alternateEngagementManager', 'director', 'execLead', 'lob',
            'allyMailId', 'cognizantEmailId'
        ];

        const currentOnlyFields = [
            'billingRate', 'department', 'homeManagerId', 'homeManagerName', 'projectPoc',
            'zId', 'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject',
            'onsiteOffshoreProject', 'allyCio'
        ];

        const requiredFields = status === 'Current' 
            ? [...alwaysRequired, ...currentOnlyFields] 
            : alwaysRequired;

        requiredFields.forEach(field => {
            const input = document.getElementById(field);
            const errorElement = document.getElementById(`${field}Error`);
            
            if (input && !input.value.trim()) {
                input.classList.add("invalid");
                errorElement.textContent = `${field.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase())} is required.`;
                isValid = false;
            } else if (input) {
                input.classList.remove("invalid");
                errorElement.textContent = '';
            }
        });

        // Additional validations
        if (status === 'Current') {
            isValid = validateFieldLength("associateId", 7, "Associate ID must be 7 digits.") && isValid;
            isValid = validateFieldLength("homeManagerId", 7, "Home Manager ID must be 7 digits.") && isValid;
        }

        return isValid;
    }

    function collectFormData() {
        const status = document.getElementById('status').value;
        const fields = getFormFields();
        const data = {};
        
        fields.forEach(field => {
            const element = document.getElementById(field);
            data[field] = status === 'Historic' && [
                'billingRate', 'department', 'homeManagerId', 'homeManagerName',
                'projectPoc', 'zId', 'integratedProject', 'onsiteOnlyProject',
                'offshoreOnlyProject', 'onsiteOffshoreProject'
            ].includes(field) ? '' : element.value;
        });
        
        return data;
    }
</script>



app.post('/submit', (req, res) => {
    const { status } = req.body;
    
    // Dynamic required fields based on status
    const alwaysRequired = [
        'esaProjectId', 'esaProjectName', 'associateId', 'name', 'designation', 'location',
        'onOff', 'billable', 'allocationStartDate', 'billingStartDate', 'allocationEndDate',
        'billingEndDate', 'status', 'requisitionSowContractNumber', 'allyTrack', 'subTrack',
        'engagementManager', 'alternateEngagementManager', 'director', 'execLead', 'lob',
        'allyMailId', 'cognizantEmailId'
    ];

    const currentOnlyFields = [
        'billingRate', 'department', 'homeManagerId', 'homeManagerName', 'projectPoc',
        'zId', 'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject',
        'onsiteOffshoreProject', 'allyCio'
    ];

    const requiredFields = status === 'Current' 
        ? [...alwaysRequired, ...currentOnlyFields] 
        : alwaysRequired;

    const missingFields = requiredFields.filter(field => !req.body[field]);
    if (missingFields.length > 0) {
        return res.status(400).json({ error: `Missing required fields: ${missingFields.join(', ')}` });
    }

    // Rest of your existing submission logic...
});
