app.post('/submit', (req, res) => {
    // ... [existing validation and data processing code]

    // Create worksheet with styling information
    const worksheet = XLSX.utils.json_to_sheet(data, { header: headers });

    // Apply column styling and status-based formatting
    data.forEach((row, rowIndex) => {
        headers.forEach((header, colIndex) => {
            const cellRef = XLSX.utils.encode_cell({ r: rowIndex + 1, c: colIndex });
            if (!worksheet[cellRef]) worksheet[cellRef] = { v: row[header] };
            
            // Initialize cell style
            worksheet[cellRef].s = {
                fill: { patternType: 'solid' },
                font: { color: {} },
                alignment: { vertical: 'center', horizontal: 'left' }
            };

            // Set column background colors
            if (colIndex < 18) { // First group of columns
                worksheet[cellRef].s.fill.fgColor = { rgb: '002060' };
            } else { // Second group of columns
                worksheet[cellRef].s.fill.fgColor = { rgb: '660066' };
            }

            // Set default font color to white
            worksheet[cellRef].s.font.color.rgb = 'FFFFFF';

            // Override font color for historic records
            if (row.Status === 'Historic') {
                worksheet[cellRef].s.font.color.rgb = 'FF0000';
            }
        });
    });

    // Style header row
    headers.forEach((header, colIndex) => {
        const cellRef = XLSX.utils.encode_cell({ r: 0, c: colIndex });
        worksheet[cellRef].s = {
            font: { bold: true, color: { rgb: '000000' } },
            fill: { patternType: 'solid', fgColor: { rgb: 'D3D3D3' } },
            alignment: { vertical: 'center', horizontal: 'center' }
        };
    });

    // ... [existing workbook creation and file saving code]
});
