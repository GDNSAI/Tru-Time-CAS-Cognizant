// Create worksheet with styling information
const worksheet = XLSX.utils.json_to_sheet(data, { header: headers });

// Style header row with two-tone background and proper alignment
headers.forEach((header, colIndex) => {
    const cellRef = XLSX.utils.encode_cell({ r: 0, c: colIndex });
    if (!worksheet[cellRef]) worksheet[cellRef] = { v: header };

    // Determine background color based on column group
    const bgColor = colIndex < 18 ? '002060' : '660066'; // First 18 columns vs rest

    worksheet[cellRef].s = {
        font: {
            bold: true,
            color: { rgb: 'FFFFFF' } // White text
        },
        fill: {
            patternType: 'solid',
            fgColor: { rgb: bgColor }
        },
        alignment: {
            vertical: 'center',
            horizontal: 'center'
        }
    };
});

// Apply historic record styling (red text) to data rows
data.forEach((row, rowIndex) => {
    if (row.Status === 'Historic') {
        headers.forEach((header, colIndex) => {
            const cellRef = XLSX.utils.encode_cell({ r: rowIndex + 1, c: colIndex }); // +1 to skip header
            if (!worksheet[cellRef]) return;

            // Preserve existing styles or initialize new ones
            worksheet[cellRef].s = worksheet[cellRef].s || {};
            worksheet[cellRef].s.font = worksheet[cellRef].s.font || {};
            worksheet[cellRef].s.font.color = { rgb: 'FF0000' }; // Red font
        });
    }
});

// Create workbook and save
const workbook = XLSX.utils.book_new();
XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet2');
XLSX.writeFile(workbook, filePath);
