app.get('/fetch-data', (req, res) => {
    const { associateId, associateName } = req.query;

    const filePath = 'C:/Users/2308397/PilotProject-Ally/attandence.xlsx';
    if (!fs.existsSync(filePath)) {
        return res.status(404).json({ error: 'Data file not found' });
    }

    const workbook = XLSX.readFile(filePath);
    const sheetName = 'Sheet1';
    const worksheet = workbook.Sheets[sheetName];

    if (!worksheet) {
        return res.status(404).json({ error: 'Sheet not found in Excel file' });
    }

    // Convert the sheet into a JSON array
    const data = XLSX.utils.sheet_to_json(worksheet);

    // Debugging: Print the data being read from the sheet
    console.log('Data read from Excel:', data);

    // Search for matching record
    const record = data.find(row => row['Associate ID'] === associateId || row['Associate Name'] === associateName);

    if (!record) {
        return res.status(404).json({ error: 'Record not found' });
    }

    // Debugging: Print the found record
    console.log('Found record:', record);

    res.json(record);
});
