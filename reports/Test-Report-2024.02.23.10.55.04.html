document.getElementById('editBtn').addEventListener('click', function (event) {
    event.preventDefault();
    const associateId = document.getElementById('associateId').value;
    
    if (!associateId) {
        alert('Please enter Associate ID');
        return;
    }
    
    // Always fetch CURRENT record for editing
    fetch(`/fetch-data?associateId=${associateId}&status=Current`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                populateFormData(data);
                document.getElementById('status').value = 'Current'; // Force status to Current
            }
        })
        .catch(error => console.error('Error:', error));
});

document.getElementById('getBtn').addEventListener('click', function (event) {
    event.preventDefault();
    const associateId = document.getElementById('associateId').value;
    const status = document.getElementById('status').value;
    
    if (!associateId) {
        alert('Please enter Associate ID');
        return;
    }
    
    // Fetch based on selected status
    fetch(`/fetch-data?associateId=${associateId}&status=${status}`)
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(data.error);
            } else {
                populateFormData(data);
            }
        })
        .catch(error => console.error('Error:', error));
});


app.get('/fetch-data', (req, res) => {
    const { associateId, status } = req.query;

    const filePath = 'attendance.xlsx';
    if (!fs.existsSync(filePath)) {
        return res.status(404).json({ error: 'File not found' });
    }

    const workbook = XLSX.readFile(filePath);
    const worksheet = workbook.Sheets['Sheet2'];
    const data = XLSX.utils.sheet_to_json(worksheet);

    // Convert both to string for reliable comparison
    const record = data.find(row => 
        row['Associate ID'].toString() === associateId.toString() && 
        row['Status'] === status
    );

    if (!record) return res.status(404).json({ error: 'Record not found' });
    res.json(record);
});
