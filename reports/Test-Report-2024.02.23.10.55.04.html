function getCurrentMonthHeaders() {
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    return Array.from({length: daysInMonth}, (_, i) => {
        const date = new Date(year, month, i + 1);
        return date.toLocaleDateString('en-GB', {day: '2-digit', month: 'short'}).replace(/ /g, '-');
    });
}

app.post('/submit', (req, res) => {
    const formData = req.body;
    const filePath = 'attendance.xlsx';

    // Validate required fields
    const requiredFields = ['associateName', 'associateId', 'status', 'projectId', 
                           'projectName', 'allocationStartDate', 'onshoreOffshore', 
                           'location', 'leaveDates', 'leaveType'];
    
    // Process leave dates
    const currentHeaders = getCurrentMonthHeaders();
    const leaveDates = formData.leaveDates.split(',')
        .map(dateStr => {
            const [year, month, day] = dateStr.split('-').map(Number);
            const date = new Date(year, month - 1, day);
            return date.toLocaleDateString('en-GB', {day: '2-digit', month: 'short'}).replace(/ /g, '-');
        })
        .filter(d => currentHeaders.includes(d));

    // Create new row data
    const defaultStatus = formData.status === 'Active' ? 'BLD' : 'UBL';
    const dateColumns = {};
    currentHeaders.forEach(header => {
        dateColumns[header] = leaveDates.includes(header) ? formData.leaveType : defaultStatus;
    });

    // Read and update existing data
    let workbook;
    let data = [];
    
    if (fs.existsSync(filePath)) {
        workbook = XLSX.readFile(filePath);
        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
        data = XLSX.utils.sheet_to_json(worksheet);
    } else {
        workbook = XLSX.utils.book_new();
    }

    // Update or add entry
    const existingIndex = data.findIndex(row => row['Associate ID'] === formData.associateId);
    const newRow = {
        'Associate Name': formData.associateName,
        'Associate ID': formData.associateId,
        'Status': formData.status,
        'Project ID': formData.projectId,
        'Project Name': formData.projectName,
        'Allocation Start Date': formData.allocationStartDate,
        'Onshore/Offshore': formData.onshoreOffshore,
        'Location': formData.location,
        ...dateColumns
    };

    if (existingIndex !== -1) {
        data[existingIndex] = newRow;
    } else {
        data.push(newRow);
    }

    // Update workbook
    const worksheet = XLSX.utils.json_to_sheet(data);
    XLSX.utils.book_append_sheet(workbook, worksheet, 'Attendance');
    XLSX.writeFile(workbook, filePath);

    res.json({ message: 'Data saved successfully!' });
});


<!-- Add this table section below the form-container -->
<h2>Attendance View</h2>
<div id="tableContainer">
    <table id="attendanceTable">
        <thead>
            <tr>
                <th>Associate Name</th>
                <th>Associate ID</th>
                <th>Status</th>
                <th>Project ID</th>
                <th>Project Name</th>
                <th>Allocation Start Date</th>
                <th>Onshore/Offshore</th>
                <th>Location</th>
                <!-- Dynamic date headers will be inserted here -->
            </tr>
        </thead>
        <tbody>
            <!-- Table rows will be populated dynamically -->
        </tbody>
    </table>
</div>

<script>
function generateDateHeaders() {
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    return Array.from({length: daysInMonth}, (_, i) => {
        const date = new Date(year, month, i + 1);
        return {
            dateStr: date.toLocaleDateString('en-GB', {day: '2-digit', month: 'short'}).replace(/ /g, '-'),
            day: date.toLocaleDateString('en-US', {weekday: 'short'})
        };
    });
}

function updateTableHeaders() {
    const table = document.getElementById('attendanceTable');
    const headerRow = table.querySelector('thead tr');
    
    // Clear existing date headers
    while(headerRow.children.length > 8) {
        headerRow.removeChild(headerRow.lastChild);
    }

    // Add new date headers
    generateDateHeaders().forEach(({dateStr, day}) => {
        const th = document.createElement('th');
        th.textContent = `${dateStr}\n${day}`;
        th.style.whiteSpace = 'pre-line';
        headerRow.appendChild(th);
    });
}

// Call this function on page load and whenever month changes
updateTableHeaders();
</script>
