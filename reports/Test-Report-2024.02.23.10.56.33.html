app.post('/submit', (req, res) => {
    const { status, ...rest } = req.body;

    // Common required fields for all statuses
    const baseRequiredFields = [
        'esaProjectId', 'esaProjectName', 'associateId', 'name', 'designation', 'location', 'onOff', 'billable',
        'allocationStartDate', 'billingStartDate', 'allocationEndDate', 'billingEndDate', 'status',
        'requisitionSowContractNumber', 'zId', 'allyTrack', 'subTrack', 'engagementManager',
        'alternateEngagementManager', 'director', 'execLead', 'lob', 'allyMailId', 'cognizantEmailId'
    ];

    // Additional fields required only for Current status
    const currentRequiredFields = [
        'billingRate', 'department', 'homeManagerId', 'homeManagerName',
        'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject', 'onsiteOffshoreProject'
    ];

    // Validate fields based on status
    const missingFields = baseRequiredFields
        .concat(status === 'Current' ? currentRequiredFields : [])
        .filter(field => !rest[field]);

    if (missingFields.length > 0) {
        return res.status(400).json({ 
            error: 'Missing required fields',
            missingFields: missingFields
        });
    }

    // ... rest of your existing code ...
});


function collectFormData() {
    const fields = getFormFields();
    const data = {};
    fields.forEach(field => {
        data[field] = document.getElementById(field).value;
    });
    return data;
}
