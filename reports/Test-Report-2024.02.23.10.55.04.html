<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Management</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h2>Attendance Management Form</h2>
    <div class="form-container">
        <!-- Keep all your existing form groups here -->
        <!-- ... (same form structure as in your original code) ... -->
    </div>
    <div class="button-container">
        <button id="submitBtn">Submit</button>
    </div>
    <table id="liveTable">
        <!-- Keep your existing table structure here -->
    </table>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            flatpickr("#leaveDates", {
                mode: "multiple",
                dateFormat: "Y-m-d",
            });

            document.getElementById('submitBtn').addEventListener('click', function (e) {
                e.preventDefault();
                if (validateForm()) {
                    submitFormData();
                }
            });

            function validateForm() {
                let isValid = true;
                const fields = ['associateId', 'associateName', 'status', 'projectId', 
                             'projectName', 'allocationStartDate', 'onshoreOffshore', 
                             'location', 'leaveDates', 'leaveType'];

                fields.forEach(field => {
                    const input = document.getElementById(field);
                    if (!input.value.trim()) {
                        document.getElementById(field + 'Error').textContent = 'This field is required';
                        isValid = false;
                    } else {
                        document.getElementById(field + 'Error').textContent = '';
                    }
                });

                return isValid;
            }

            async function submitFormData() {
                const formData = {
                    associateId: document.getElementById('associateId').value,
                    associateName: document.getElementById('associateName').value,
                    status: document.getElementById('status').value,
                    projectId: document.getElementById('projectId').value,
                    projectName: document.getElementById('projectName').value,
                    allocationStartDate: document.getElementById('allocationStartDate').value,
                    onshoreOffshore: document.getElementById('onshoreOffshore').value,
                    location: document.getElementById('location').value,
                    leaveDates: document.getElementById('leaveDates').value,
                    leaveType: document.getElementById('leaveType').value
                };

                try {
                    const response = await fetch('/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData)
                    });

                    const result = await response.json();
                    if (response.ok) {
                        alert('Data saved successfully!');
                        addRowToTable(formData);
                        document.querySelector('.form-container').reset();
                    } else {
                        alert(`Error: ${result.error}`);
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred while saving data');
                }
            }

            function addRowToTable(data) {
                const table = document.getElementById('liveTable').getElementsByTagName('tbody')[0];
                const row = table.insertRow();
                const timestamp = new Date().toLocaleString();

                row.innerHTML = `
                    <td>${table.rows.length + 1}</td>
                    <td>${timestamp}</td>
                    <td>${data.associateId}</td>
                    <td>${data.associateName}</td>
                    <td>${data.status}</td>
                    <td>${data.projectId}</td>
                    <td>${data.projectName}</td>
                    <td>${data.allocationStartDate}</td>
                    <td>${data.onshoreOffshore}</td>
                    <td>${data.location}</td>
                    <td>${data.leaveDates}</td>
                    <td class="${data.leaveType.toLowerCase()}">${data.leaveType}</td>
                `;
            }
        });
    </script>
</body>
</html>
