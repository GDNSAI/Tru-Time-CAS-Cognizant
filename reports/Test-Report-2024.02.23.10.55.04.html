document.getElementById('editBtn').addEventListener('click', function (event) {
    event.preventDefault();
    const associateId = document.getElementById('associateId').value;
    
    if (!associateId) {
        alert('Please enter Associate ID');
        return;
    }
    
    // Fetch only CURRENT records
    fetch(`/fetch-data?associateId=${associateId}&status=Current`)
        .then(response => {
            if (!response.ok) throw new Error('Record not found');
            return response.json();
        })
        .then(data => {
            populateFormData(data);
            document.getElementById('status').value = 'Current';
        })
        .catch(error => {
            alert(`No current record found for ID ${associateId}`);
            clearForm();
        });
});

document.getElementById('getBtn').addEventListener('click', function (event) {
    event.preventDefault();
    const associateId = document.getElementById('associateId').value;
    const status = document.getElementById('status').value;
    
    if (!associateId) {
        alert('Please enter Associate ID');
        return;
    }
    
    fetch(`/fetch-data?associateId=${associateId}&status=${status}`)
        .then(response => {
            if (!response.ok) throw new Error('Record not found');
            return response.json();
        })
        .then(data => populateFormData(data))
        .catch(error => {
            alert(`No ${status.toLowerCase()} record found for ID ${associateId}`);
            clearForm();
        });
});


app.get('/fetch-data', (req, res) => {
    const { associateId, status } = req.query;
    
    if (!associateId || !status) {
        return res.status(400).json({ error: 'Missing parameters' });
    }

    const filePath = 'attendance.xlsx';
    if (!fs.existsSync(filePath)) {
        return res.status(404).json({ error: 'File not found' });
    }

    const workbook = XLSX.readFile(filePath);
    const worksheet = workbook.Sheets['Sheet2'];
    const data = XLSX.utils.sheet_to_json(worksheet);

    // Exact match search with type conversion
    const record = data.find(row => 
        row['Associate ID'].toString() === associateId.toString() && 
        row['Status'] === status
    );

    if (!record) {
        return res.status(404).json({ error: 'Record not found' });
    }
    
    res.json(record);
});
