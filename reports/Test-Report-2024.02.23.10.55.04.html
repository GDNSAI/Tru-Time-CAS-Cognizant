const Excel = require('exceljs');
const moment = require('moment');
const fs = require('fs');

const excelFilePath = './output.xlsx';

async function createExcelFile() {
    const workbook = new Excel.Workbook();
    const worksheet = workbook.addWorksheet('Attendance');

    // Fixed headers for first row
    const headers = [
        'Associate Name', 'Associate ID', 'Status', 'Project ID', 'Project Name', 
        'Allocation', 'Start Date', 'Onshore/Offshore', 'Location'
    ];

    // Generate the full date range for the year (January 1st to December 31st)
    const dates = getYearDates(moment().year());

    // Add headers to the first row
    worksheet.addRow(headers.concat(dates));

    // Add days of the week to the second row
    const daysOfWeek = dates.map(date => moment(date, 'DD-MMM-YYYY').format('ddd'));
    worksheet.addRow([''].concat(daysOfWeek));

    // Write the workbook to a file
    await workbook.xlsx.writeFile(excelFilePath);
    console.log('Excel file created with headers and day names');
}

function getYearDates(year) {
    const startDate = moment(`${year}-01-01`);
    const endDate = moment(`${year}-12-31`);
    const dates = [];

    let currentDate = startDate;
    while (currentDate.isSameOrBefore(endDate)) {
        dates.push(currentDate.format('DD-MMM-YYYY')); // Format as DD-MMM-YYYY
        currentDate.add(1, 'day');
    }
    return dates;
}

if (!fs.existsSync(excelFilePath)) {
    createExcelFile();
}
