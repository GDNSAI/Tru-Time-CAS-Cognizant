const ExcelJS = require('exceljs');

async function createAllocationSheet(year) {
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet('Allocations');

    // Initial headers (first part of the header row)
    const initialHeaders = [
        'Associate Name',
        'Associate ID',
        'Status',
        'Project ID',
        'Project Name',
        'Allocation Start Date',
        'Onshore/Offshore',
        'Location'
    ];

    // Generate dates and days for the entire year in UTC
    const datesFormatted = [];
    const daysFormatted = [];
    let currentDate = new Date(Date.UTC(year, 0, 1)); // Start from Jan 1 of the given year

    while (currentDate.getUTCFullYear() === year) {
        datesFormatted.push(formatDate(currentDate));
        daysFormatted.push(formatDay(currentDate));
        currentDate.setUTCDate(currentDate.getUTCDate() + 1);
    }

    // Create first header row: initial headers + dates
    worksheet.addRow([...initialHeaders, ...datesFormatted]);

    // Create second header row: empty strings for initial headers + days
    const secondRow = new Array(initialHeaders.length).fill('').concat(daysFormatted);
    worksheet.addRow(secondRow);

    // Save the workbook
    await workbook.xlsx.writeFile('Yearly_Allocations.xlsx');
    console.log('Excel file created successfully.');
}

// Helper function to format date as 'DD-MMM'
function formatDate(date) {
    const day = String(date.getUTCDate()).padStart(2, '0');
    const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return `${day}-${months[date.getUTCMonth()]}`;
}

// Helper function to get day abbreviation (e.g., 'Mon')
function formatDay(date) {
    const days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
    return days[date.getUTCDay()];
}

// Example usage: create for the year 2024
createAllocationSheet(2024).catch(console.error);
