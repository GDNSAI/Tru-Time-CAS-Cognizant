// Add status change handler to clear fields
document.getElementById('status').addEventListener('change', function() {
    if (this.value === 'Historic') {
        clearHistoricFields();
    }
});

// Function to clear historic-specific fields
function clearHistoricFields() {
    const fieldsToClear = [
        'billingRate', 'homeManagerId', 'homeManagerName', 'projectPoc', 'zId',
        'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject', 'onsiteOffshoreProject'
    ];
    
    fieldsToClear.forEach(field => {
        document.getElementById(field).value = '';
        document.getElementById(field).disabled = true; // Optional: disable fields
    });
}

// Modify collectFormData
function collectFormData() {
    const fields = getFormFields();
    const data = {};
    
    fields.forEach(field => {
        data[field] = document.getElementById(field).value;
    });
    
    return data;
}



app.post('/submit', (req, res) => {
    const { status, ...formData } = req.body;

    // Common validation for all records
    const baseValidation = [
        'esaProjectId', 'esaProjectName', 'associateId', 'name', 'designation',
        'location', 'onOff', 'billable', 'allocationStartDate', 'billingStartDate',
        'allocationEndDate', 'billingEndDate', 'status', 'requisitionSowContractNumber',
        'allyTrack', 'subTrack', 'engagementManager', 'alternateEngagementManager',
        'director', 'execLead', 'lob', 'allyMailId', 'cognizantEmailId'
    ];

    // Additional validation for current records
    const currentOnlyValidation = [
        'billingRate', 'homeManagerId', 'homeManagerName', 'projectPoc', 'zId',
        'integratedProject', 'onsiteOnlyProject', 'offshoreOnlyProject', 'onsiteOffshoreProject'
    ];

    // Validate fields
    const missingFields = baseValidation.filter(field => !formData[field]);
    
    if (status === 'Current') {
        missingFields.push(...currentOnlyValidation.filter(field => !formData[field]));
    }

    if (missingFields.length > 0) {
        return res.status(400).json({
            error: `Missing required fields: ${missingFields.join(', ')}`
        });
    }

    // ... rest of your existing save logic ...
});
